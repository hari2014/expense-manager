<html ng-app="project">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker</title>
  <!-- styles -->
  <link href="//netdna.bootstrapcdn.com/bootswatch/3.3.6/yeti/bootstrap.min.css" rel="stylesheet" media="screen">
</head>


  <body>

  <div class="container">
      <div  ng-view></div>
    </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.10/angular.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.10/angular-route.min.js" type="text/javascript"></script>
      <script src="{{ url_for('static', filename = 'angularJS/js/route.js') }}"></script>
      <script src="{{ url_for('static', filename = 'angularJS/js/controller.js') }}"></script>
  <script src="{{ url_for('static', filename = 'angularJS/js/service.js') }}"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="{{ url_for('static', filename = 'css/workaround.css') }}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{{ url_for('static', filename = 'css/template.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename = 'css/login.css') }}" rel="stylesheet">

      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="{{ url_for('static', filename = 'js/workaround.js') }}"></script>


<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var jsonData = $.ajax({
          url: "/data",
          dataType: "json",
          async: false
          }).responseText;
       console.log(jsonData);


      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Category');
        data.addColumn('number', 'Amount');
        data.addRows(JSON.parse(jsonData));

  var options = {
          is3D: true
        };


      var chart = new google.visualization.PieChart(document.getElementById('pie'));
      chart.draw(data, options);

         var chart1 = new google.visualization.ColumnChart(document.getElementById('column'));
      chart1.draw(data, {width: 500, height: 400});
var ct=0;

google.visualization.events.addListener(chart, 'select', function() {
ct=ct+1;
 var selection = chart.getSelection();
  var message = '';
  for (var i = 0; i < selection.length; i++) {
    var item = selection[i];
    if (item.row != null && item.column != null) {
      var str = data.getFormattedValue(item.row, item.column);
      message += '{row:' + item.row + ',column:' + item.column + '} = ' + str + '\n';
    } else if (item.row != null) {
      var str = data.getFormattedValue(item.row, 0);
      message += '{row:' + item.row + ', column:none}; value (col 0) = ' + str + '\n';
    } else if (item.column != null) {
      var str = data.getFormattedValue(0, item.column);
      message += '{row:none, column:' + item.column + '}; value (row 0) = ' + str + '\n';
    }
  }
  if (message == '') {
    message = 'nothing';
  }
  //alert( str);
  var s=str;

      var jsonData = $.ajax({
          url: "/drill",
          type:'POST',
           data:JSON.stringify({'message':s}),
          dataType: "json",
          contentType: 'application/json; charset=UTF-8',
          async: false
          }).responseText;

      //alert(jsonData);


    var data1 = new google.visualization.DataTable();
      data1.addColumn('string', 'Date');
        data1.addColumn('number', 'Amount');

        data1.addRows(JSON.parse(jsonData));

       var drill = new google.visualization.ColumnChart(document.getElementById('column'));
      drill.draw(data1, {width: 500, height: 400});
      chart1.setSelection(chart.getSelection());
});
}

      </script>
  </body>

  </html>